{"version":3,"sources":["file:///Users/hanchuang/Games/RotateBlock/assets/src/Block.ts"],"names":["_decorator","CCInteger","Component","instantiate","NodeEventType","Prefab","UIOpacity","UITransform","Vec2","Vec3","BlockEnum","GameController","ccclass","property","Block","type","rotation","grids","used","width","height","start","generate","node","on","TOUCH_START","touchStart","data","getRotation","getComponent","console","log","i","length","GridPrefab","x","y","Math","floor","setPosition","addChild","opacity","push","random","randomRotation","event","off","TOUCH_CANCEL","touchCancel","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","Instance","currentBlock","index","touch","_point","_startPoint","getPosition","test","update","deltaTime","isUsed","use","reset"],"mappings":"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","sourcesContent":["import { _decorator, CCInteger, Component, instantiate, Node, NodeEventType, Prefab, UIOpacity, UITransform, Vec2, Vec3 } from 'cc';\nimport { BlockEnum } from './BlockEnum';\nimport { GameController } from './GameController';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Block')\nexport class Block extends Component {\n\n\n    type;\n    rotation = 0;\n\n    @property({\n        type: Prefab,\n    })\n    GridPrefab: Prefab;\n\n    @property({\n        type: CCInteger,\n    })\n    index: Number;\n\n    grids = [];\n\n    used;\n\n    width = 0;\n    height = 0;\n\n    start() {\n        this.generate();\n\n        this.node.on(NodeEventType.TOUCH_START, this.touchStart, this);\n\n        let data = BlockEnum.getRotation(this.type, this.rotation);\n\n        this.width = 160;\n        this.height = 160;\n\n        this.node.getComponent(UITransform).width = 80 * 2;\n        this.node.getComponent(UITransform).height = 80 * 2;\n        console.log(data);\n\n        for (let i = 0; i < data.length; i++) {\n            let node = instantiate(this.GridPrefab);\n            let x = (data[i] % 8) * 80 + 40;\n            let y = Math.floor(data[i] / 8) * 80 + 40;\n            node.setPosition(new Vec3(x, y, 0));\n            this.node.addChild(node);\n            node.getComponent(UIOpacity).opacity = 255;\n            this.grids.push(node);\n        }\n\n        this.node.on(NodeEventType.TOUCH_START, this.touchStart, this);\n\n    }\n\n    public generate() {\n        this.type = Math.floor(Math.random() * 16);\n        this.rotation = BlockEnum.randomRotation(this.type)\n    }\n\n    public touchStart(event) {\n        this.node.off(NodeEventType.TOUCH_START, this.touchStart, this);\n        this.node.on(NodeEventType.TOUCH_CANCEL, this.touchCancel, this);\n        this.node.on(NodeEventType.TOUCH_MOVE, this.touchMove, this, true);\n        this.node.on(NodeEventType.TOUCH_END, this.touchEnd, this);\n        console.log(\"start\");\n        GameController.Instance.currentBlock = this.index;\n    }\n\n    public touchMove(event) {\n        // console.log(event.touch);\n        this.node.setPosition(new Vec3(event.touch._point.x - 480,\n            event.touch._point.y - event.touch._startPoint.y));\n    }\n\n    public touchEnd(event) {\n        console.log(\"end\");\n        this.node.on(NodeEventType.TOUCH_START, this.touchStart, this);\n        this.node.off(NodeEventType.TOUCH_CANCEL, this.touchCancel, this);\n        this.node.off(NodeEventType.TOUCH_MOVE, this.touchMove, this);\n        this.node.off(NodeEventType.TOUCH_END, this.touchEnd, this);\n        this.node.getComponent(UIOpacity).opacity = 0;\n    }\n\n    public touchCancel(event) {\n        this.node.on(NodeEventType.TOUCH_START, this.touchStart, this);\n        this.node.off(NodeEventType.TOUCH_CANCEL, this.touchCancel, this);\n        this.node.off(NodeEventType.TOUCH_MOVE, this.touchMove, this);\n        this.node.off(NodeEventType.TOUCH_END, this.touchEnd, this);\n        console.log(\"cancel\");\n        this.node.getComponent(UIOpacity).opacity = 0;\n\n        console.log(this.node.getPosition());\n\n        GameController.Instance.test(new Vec2(this.node.getPosition().x, this.node.getPosition().y - this.height),\n            { type: this.type, rotation: this.rotation })\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    public isUsed() {\n        return this.used;\n    }\n\n    public use() {\n        this.used = true;\n    }\n\n    public reset() {\n        this.used = false;\n    }\n}\n\n"]}